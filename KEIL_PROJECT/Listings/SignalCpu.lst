C51 COMPILER V9.54   SIGNALCPU                                                             02/04/2020 15:00:12 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE SIGNALCPU
OBJECT MODULE PLACED IN .\Objects\SignalCpu.obj
COMPILER INVOKED BY: C:\sd\Keil_v5\C51\BIN\C51.EXE SignalCpu.c OMF2 OPTIMIZE(8,SPEED) BROWSE DEBUG PRINT(.\Listings\Sign
                    -alCpu.lst) TABS(2) OBJECT(.\Objects\SignalCpu.obj)

line level    source

   1          #include "STC15.h"
   2          #include "Delayer.h"
   3          #include "IO_PORT.h"
   4          #include "motor.h"
   5          #include "WatchDog.h"
   6          #include "inductor.h"
   7          #include "Water.h"
   8          #include "threading.h"
   9          
  10          
  11          unsigned long int idata timerTime=7200000; //定时启ms
  12          //感应器触发时间间隔，在这里个时间内只能触发一次
  13          unsigned long int idata interval_time=900000;
  14          
  15          unsigned long int idata interval_last_time=0;
  16          
  17          void timer_run(void);
  18          void timeLine(void);
  19          void en_bt(void);
  20          void runLine(void);
  21          char runLine_state=-1;//流水线的状态，0开始执行，1执行完成
  22          void inductor_run();
  23          unsigned long int idata now_start;
  24          unsigned long int idata led_timer_start;
  25          
  26          
  27          void timeLine(void)
  28          {
  29   1      
  30   1          now_start=now;//初始化定时函数变量
  31   1          led_timer_start=now;
  32   1          while(1)
  33   1          {
  34   2              watch_feed_dog();//喂狗
  35   2              en_bt();
  36   2              timer_run();
  37   2              inductor_run();
  38   2              if(now-led_timer_start >1000)
  39   2              {
  40   3                  led_timer_start=now;
  41   3                  P55=~P55;
  42   3      
  43   3              }
  44   2      
  45   2          }
  46   1      
  47   1      
  48   1      }
  49          
  50          
  51          
  52          
  53          
  54          
C51 COMPILER V9.54   SIGNALCPU                                                             02/04/2020 15:00:12 PAGE 2   

  55          void runLine(void)
  56          {
  57   1          
  58   1          inductor_close_all();
  59   1          motor2_make_zero();
  60   1          water_op();
  61   1          wait(5000);
  62   1          water_op();
  63   1          motor2_move(-100,10);
  64   1          motor2_move(-100,10);
  65   1          motor_run();
  66   1          motor2_move(-100,10);
  67   1          motor2_move(-100,10);
  68   1          motor2_move(-25,4);
  69   1          wait(5000);
  70   1          water_cl();
  71   1          wait(5000);
  72   1          motor_stop();
  73   1          motor2_make_zero();
  74   1          inductor_open_all();
  75   1          interval_last_time=now;
  76   1      }
  77          
  78          
  79          
  80          void timer_run(void)
  81          {
  82   1      //定时启动函数
  83   1          if(now>= (now_start+timerTime ))
  84   1          {
  85   2              inductor_close_all();//关闭所有感应器
  86   2              runLine();
  87   2              now_start=now;
  88   2              inductor_open_all();//开启所有感应器
  89   2          }
  90   1      }
  91          
  92          
  93          
  94          
  95          void inductor_run()
  96          {
  97   1          unsigned long int idata temp=(now-inductor_en_time_start);
  98   1          unsigned long int idata temp2=(now-interval_last_time);
  99   1          if(inductor_en==1 && io_inductor==1 && temp>120000 && temp2 > interval_time)
 100   1          {
 101   2              inductor_close_all();//关闭所有感应器
 102   2              if((table_analyze()).data_shake)
 103   2              {
 104   3                  runLine();
 105   3                  indector_last_time=now;
 106   3                  inductor_en=0;
 107   3                  table_inductor_clear_all();
 108   3              }
 109   2              else
 110   2              {
 111   3                  inductor_en=0;
 112   3              }
 113   2              inductor_open_all();//开启所有感应器
 114   2          }
 115   1      }
 116          
C51 COMPILER V9.54   SIGNALCPU                                                             02/04/2020 15:00:12 PAGE 3   

 117          
 118          
 119          
 120          
 121          
 122          
 123          
 124          
 125          
 126          
 127          /********
 128          en_bt 函数
 129          检查按键，并作出相应功能
 130          此函数不涉及中断
 131          *********/
 132          
 133          void en_bt(void)
 134          {
 135   1          if(io_bt_motor2_back==0)
 136   1          {
 137   2            delay500ms();
 138   2              IE2&=~0x01; //串口中断
 139   2              motor2_make_zero();
 140   2          }
 141   1      
 142   1          if(io_bt_motor2_go==0)
 143   1          {
 144   2            delay500ms();
 145   2               IE2|=0x01; //串口中断
 146   2               io_motor_ena=~io_motor_ena;
 147   2          }
 148   1          if(io_bt_water_ena==0)
 149   1          {
 150   2      
 151   2              delay500ms();
 152   2              water_set();
 153   2          }
 154   1          if(io_bt_inductor_en==0)
 155   1          {
 156   2      
 157   2              runLine();
 158   2      
 159   2          }
 160   1      
 161   1      }
 162          
 163          
 164          
 165          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    440    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =     20       8
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
C51 COMPILER V9.54   SIGNALCPU                                                             02/04/2020 15:00:12 PAGE 4   

   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
